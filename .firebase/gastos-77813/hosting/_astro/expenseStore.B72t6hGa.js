import{ac as l,ad as u,B as h,ae as b,u as y,o as v}from"./template.CsvUa5oO.js";import{d,w as f}from"./store.CUww-eZX.js";import{q as _,o as C,c as F,f as E,d as D}from"./firebase.C6L9Uwjb.js";function O(t){l===null&&u(),h&&l.l!==null?B(l).m.push(t):b(()=>{const a=y(t);if(typeof a=="function")return a})}function S(t){l===null&&u(),O(()=>()=>y(t))}function w(t,a,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(t,{detail:a,bubbles:n,cancelable:o})}function q(){const t=l;return t===null&&u(),(a,n,o)=>{const e=t.s.$$events?.[a];if(e){const r=v(e)?e.slice():[e],s=w(a,n,o);for(const c of r)c.call(t.x,s);return!s.defaultPrevented}return!0}}function B(t){var a=t.l;return a.u??={a:[],b:[],m:[]}}const x=()=>{const{subscribe:t,set:a}=f({loading:!0,data:[],error:null}),n=_(F(D,"gastos"),C("fecha","desc")),o=E(n,e=>{const r=e.docs.map(s=>{const c=s.data();return{id:s.id,descripcion:c.descripcion,categoria:c.categoria||"Otros",fecha:c.fecha?.toDate?c.fecha.toDate():new Date,monto:Number(c.cantidad)||0}});a({loading:!1,data:r,error:null})},e=>{console.error("Firebase snapshot error:",e),a({loading:!1,data:[],error:"Failed to load expenses."})});return{subscribe:t,unsubscribe:o}},m=x(),L={Ocio:"#FF6384","Comida/Bebida":"#36A2EB",Hogar:"#FFCE56","Gastos Personales":"#4BC0C0",Otros:"#9966FF",Default:"#C9CBCF"},I=d(m,t=>{if(t.loading||!t.data.length)return[];const a=t.data.reduce((n,o)=>{const e=o.fecha.getFullYear(),r=o.monto;return n[e]||(n[e]={year:e,total:0}),n[e].total+=r,n},{});return Object.values(a).sort((n,o)=>n.year-o.year)}),Y=d(m,t=>{if(t.loading||!t.data.length)return[];const a=t.data.reduce((o,e)=>{const r=e.fecha,s=r.getFullYear(),c=r.toLocaleString("es-ES",{month:"long"}),i=`${s}-${c}`,p=e.monto;return o[i]||(o[i]={year:s,month:c,total:0}),o[i].total+=p,o},{}),n=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];return Object.values(a).sort((o,e)=>o.year!==e.year?e.year-o.year:n.indexOf(e.month.toLowerCase())-n.indexOf(o.month.toLowerCase()))}),g=f(1),P=f(10),z=d([m,g,P],([t,a,n])=>{if(t.loading)return{paginatedData:[],totalPages:1,...t};const o=Math.ceil(t.data.length/n),e=(a-1)*n,r=e+n,s=t.data.slice(e,r);return{...t,paginatedData:s,totalPages:o}}),A=t=>{g.update(a=>a<t?a+1:a)},G=()=>{g.update(t=>t>1?t-1:t)};export{S as a,g as b,q as c,G as d,m as e,L as f,Y as m,A as n,O as o,z as p,I as y};
